# 送信型共有機能 仕様書

---

## 1. 機能概要

- 本機能は、家族間でのタブとリストの送信・受信を実現するためのものです。
- ユーザーが個人で作成したタブやリストを、ファミリーメンバーに送信し、受信者が自分のアプリに受け取って管理できる仕組みを提供します。

---

## 2. 用語定義

| 用語           | 定義                                         |
|----------------|----------------------------------------------|
| ファミリー     | 共有グループの単位                           |
| メンバー       | ファミリーに所属するユーザー                 |
| オーナー       | ファミリーの管理者権限を持つ人               |
| 送信コンテンツ | ファミリーメンバーに送信されるタブやリスト   |
| 受信コンテンツ | 他のメンバーから受信したタブやリスト         |
| タブ           | 複数のリストやショップをまとめるグループ単位 |
| リスト         | 買い物やタスクなどの項目をまとめた一覧       |
| 送信者         | タブやリストを送信するユーザー               |
| 受信者         | タブやリストを受信するユーザー               |

---

## 3. 要件定義

### 3.1 目的・概要（What/Who）

- 家族や同居人など、複数人で買い物リストやタブを送信・受信できる仕組みを提供する。
- 主なターゲットは、家族やパートナー、ルームメイトなど、日常的に情報共有が必要なグループ。
- 個人で作成したコンテンツを、選択したファミリーメンバーに送信し、受信者が自分のアプリで管理できるようにする。

### 3.2 機能要件（What/How）

#### 3.2.1 送信機能
- 個人で作成したタブやリストの送信
- 送信先メンバーの選択（複数選択可能）
- 送信履歴の管理
- 送信済みコンテンツの表示

#### 3.2.2 受信機能
- 受信したタブやリストの表示
- 受信コンテンツの受け取り確認
- 受け取ったコンテンツを自分のリストに追加
- 受信履歴の管理

#### 3.2.3 管理機能
- 送信済みコンテンツの削除
- 受信済みコンテンツの削除
- 送信・受信状態の確認

### 3.3 画面構成（UI/UX）

#### 3.3.1 送信画面
- 送信可能なタブ・リストの一覧表示
- 各コンテンツの送信ボタン
- 送信先メンバー選択ダイアログ
- 送信確認ダイアログ

#### 3.3.2 受信画面
- 受信したコンテンツの一覧表示
- 受け取り確認ダイアログ
- 受け取ったコンテンツの管理

#### 3.3.3 履歴画面
- 送信履歴の表示
- 受信履歴の表示
- 送信・受信状態の確認

### 3.4 非機能要件（Quality）

- セキュリティ（認証・認可によるアクセス制御）
- パフォーマンス（複数人同時利用時も快適に動作）
- データ整合性（送信・受信データの正確性保証）
- プライバシー保護（送信者・受信者の情報保護）

---

## 4. 画面設計

### 4.1 送信コンテンツ画面

#### 4.1.1 送信可能コンテンツ一覧
- 個人で作成したタブ・リストの表示
- 各コンテンツに「送信」ボタンを配置
- 送信済みコンテンツの識別表示

#### 4.1.2 送信先選択ダイアログ
- ファミリーメンバーの一覧表示
- 複数選択可能なチェックボックス
- 送信確認ボタン

#### 4.1.3 送信確認ダイアログ
- 送信先メンバーの表示
- 送信するコンテンツの詳細表示
- 送信実行ボタン

### 4.2 受信コンテンツ画面

#### 4.2.1 受信コンテンツ一覧
- 受信したタブ・リストの表示
- 送信者情報の表示
- 受信日時の表示
- 受け取り状態の表示

#### 4.2.2 受け取り確認ダイアログ
- 受信コンテンツの詳細表示
- 送信者情報の表示
- 受け取り実行ボタン

### 4.3 履歴画面

#### 4.3.1 送信履歴
- 送信したコンテンツの一覧
- 送信先メンバーの表示
- 送信日時の表示
- 受信状態の表示

#### 4.3.2 受信履歴
- 受信したコンテンツの一覧
- 送信者の表示
- 受信日時の表示
- 受け取り状態の表示

---

## 5. データ設計

### 5.1 送信データ構造
```dart
class SentContent {
  String id;
  String contentId; // 元のタブ・リストのID
  String contentType; // 'tab' または 'list'
  String contentName;
  String sentTo; // 受信者のID
  String sentToName; // 受信者の名前
  DateTime sentAt;
  bool isReceived; // 受信者が受け取ったかどうか
  Map<String, dynamic> contentData; // コンテンツの詳細データ
}
```

### 5.2 受信データ構造
```dart
class ReceivedContent {
  String id;
  String originalContentId; // 元のコンテンツID
  String contentType; // 'tab' または 'list'
  String contentName;
  String sentBy; // 送信者のID
  String sentByName; // 送信者の名前
  DateTime receivedAt;
  bool isAccepted; // 受け取ったかどうか
  Map<String, dynamic> contentData; // コンテンツの詳細データ
}
```

---

## 6. 処理フロー

### 6.1 送信フロー
1. ユーザーが送信したいコンテンツを選択
2. 送信先メンバーを選択
3. 送信確認ダイアログを表示
4. 送信データをFirestoreに保存
5. 送信完了通知を表示

### 6.2 受信フロー
1. 受信したコンテンツを一覧で表示
2. ユーザーが受け取りを選択
3. 受け取り確認ダイアログを表示
4. 受信コンテンツをユーザーのリストに追加
5. 受信状態を更新

---

## 7. セキュリティ要件

- ファミリーメンバーのみが送信・受信可能
- 送信データの暗号化
- 受信者の認証確認
- 不正アクセスの防止
