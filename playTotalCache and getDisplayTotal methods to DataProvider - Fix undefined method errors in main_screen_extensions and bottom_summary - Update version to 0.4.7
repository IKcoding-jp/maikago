warning: in the working copy of 'lib/providers/data_provider.dart', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'lib/screens/main_screen_body.dart', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'lib/screens/main_screen_extensions.dart', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'lib/screens/settings_persistence.dart', LF will be replaced by CRLF the next time Git touches it
warning: in the working copy of 'lib/widgets/bottom_summary.dart', LF will be replaced by CRLF the next time Git touches it
[1mdiff --git a/lib/providers/data_provider.dart b/lib/providers/data_provider.dart[m
[1mindex 442c99f..6af9ba9 100644[m
[1m--- a/lib/providers/data_provider.dart[m
[1m+++ b/lib/providers/data_provider.dart[m
[36m@@ -18,31 +18,48 @@[m [mclass DataProvider extends ChangeNotifier {[m
   DateTime? _lastSyncTime; // æœ€çµ‚åŒæœŸæ™‚åˆ»[m
 [m
   DataProvider() {[m
[32m+[m[32m    debugPrint('=== DataProvider ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ===');[m
     // åˆæœŸåŒ–æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿[m
     WidgetsBinding.instance.addPostFrameCallback((_) {[m
[32m+[m[32m      debugPrint('DataProvider: åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚’é–‹å§‹');[m
       loadData();[m
     });[m
   }[m
 [m
   // èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®š[m
   void setAuthProvider(AuthProvider authProvider) {[m
[32m+[m[32m    debugPrint('=== setAuthProvider ===');[m
[32m+[m[32m    debugPrint('èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®š: ${authProvider.isLoggedIn ? 'ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿' : 'æœªãƒ­ã‚°ã‚¤ãƒ³'}');[m
     _authProvider = authProvider;[m
   }[m
 [m
   // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒåŒ¿åã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨ã™ã¹ãã‹ã©ã†ã‹ã‚’åˆ¤å®š[m
   bool get _shouldUseAnonymousSession {[m
[31m-    if (_authProvider == null) return false;[m
[31m-    return !_authProvider!.isLoggedIn;[m
[32m+[m[32m    if (_authProvider == null) {[m
[32m+[m[32m      debugPrint('_shouldUseAnonymousSession: èªè¨¼ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ãŒnullã®ãŸã‚false');[m
[32m+[m[32m      return false;[m
[32m+[m[32m    }[m
[32m+[m[32m    final result = !_authProvider!.isLoggedIn;[m
[32m+[m[32m    debugPrint([m
[32m+[m[32m      '_shouldUseAnonymousSession: ${_authProvider!.isLoggedIn ? 'ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿' : 'æœªãƒ­ã‚°ã‚¤ãƒ³'} -> $result',[m
[32m+[m[32m    );[m
[32m+[m[32m    return result;[m
   }[m
 [m
   // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—ã‚’ç¢ºä¿[m
[31m-  void _ensureDefaultShop() {[m
[32m+[m[32m  Future<void> _ensureDefaultShop() async {[m
[32m+[m[32m    debugPrint('=== _ensureDefaultShop ===');[m
[32m+[m
     // æ—¢å­˜ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯[m
     final existingDefaultShop = _shops[m
         .where((shop) => shop.id == '0')[m
         .firstOrNull;[m
 [m
[32m+[m[32m    debugPrint('æ—¢å­˜ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—: ${existingDefaultShop?.name}');[m
[32m+[m
     if (existingDefaultShop == null) {[m
[32m+[m[32m      debugPrint('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—ãŒå­˜åœ¨ã—ãªã„ãŸã‚ä½œæˆã—ã¾ã™');[m
[32m+[m
       // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—ãŒå­˜åœ¨ã—ãªã„å ´åˆã®ã¿ä½œæˆ[m
       final defaultShop = Shop([m
         id: '0',[m
[36m@@ -52,6 +69,8 @@[m [mclass DataProvider extends ChangeNotifier {[m
       );[m
       _shops.add(defaultShop);[m
 [m
[32m+[m[32m      debugPrint('ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ§ãƒƒãƒ—ã‚’ä½œæˆ: ${defaultShop.name}');[m
[32m+[m
       // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã®ã¿Firebaseã«ä¿å­˜[m
       if (!_isLocalMode) {[m
         _dataService[m
[36m@@ -67,47 +86,89 @@[m [mclass DataProvider extends ChangeNotifier {[m
     }[m
   }[m
 [m
[31m-  List<Item> get items => _items;[m
[31m-  List<Shop> get shops => _shops;[m
[31m-  bool get isLoading => _isLoading;[m
[31m-  bool get isSynced => _isSynced;[m
[31m-  bool get isLocalMode => _isLocalMode;[m
[32m+[m[32m  List<Item> get items {[m
[32m+[m[32m    debugPrint('DataProvider.items: ${_items.length}ä»¶');[m
[32m+[m[32m    return _items;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  List<Shop> get shops {[m
[32m+[m[32m    debugPrint('DataProvider.shops: ${_shops.length}ä»¶');[m
[32m+[m[32m    return _shops;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  bool get isLoading {[m
[32m+[m[32m    debugPrint('DataProvider.isLoading: $_isLoading');[m
[32m+[m[32m    return _isLoading;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  bool get isSynced {[m
[32m+[m[32m    debugPrint('DataProvider.isSynced: $_isSynced');[m
[32m+[m[32m    return _isSynced;[m
[32m+[m[32m  }[m
[32m+[m
[32m+[m[32m  bool get isLocalMode {[m
[32m+[m[32m    debugPrint('DataProvider.isLocalMode: $_isLocalMode');[m
[32m+[m[32m    return _isLocalMode;[m
[32m+[m[32m  }[m
 [m
   // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š[m
   void setLocalMode(bool isLocal) {[m
[32m+[m[32m    debugPrint('=== setLocalMode ===');[m
[32m+[m[32m    debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰è¨­å®š: $isLocal');[m
[32m+[m
     _isLocalMode = isLocal;[m
     if (isLocal) {[m
       _isSynced = true; // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ã¯å¸¸ã«åŒæœŸæ¸ˆã¿ã¨ã—ã¦æ‰±ã†[m
[32m+[m[32m      debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®šã€åŒæœŸæ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯');[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã«è¨­å®š');[m
     }[m
     notifyListeners();[m
   }[m
 [m
   // ã‚¢ã‚¤ãƒ†ãƒ ã®æ“ä½œ[m
   Future<void> addItem(Item item) async {[m
[32m+[m[32m    debugPrint('=== addItem ===');[m
[32m+[m[32m    debugPrint([m
[32m+[m[32m      'è¿½åŠ ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ : ${item.name}, ã‚·ãƒ§ãƒƒãƒ—ID: ${item.shopId}, ãƒã‚§ãƒƒã‚¯æ¸ˆã¿: ${item.isChecked}',[m
[32m+[m[32m    );[m
[32m+[m
     // é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆIDãŒç©ºã®å ´åˆã¯æ–°è¦è¿½åŠ ã¨ã—ã¦æ‰±ã†ï¼‰[m
     if (item.id.isNotEmpty) {[m
       final existingIndex = _items.indexWhere((i) => i.id == item.id);[m
       if (existingIndex != -1) {[m
[32m+[m[32m        debugPrint('æ—¢å­˜ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°ã—ã¾ã™');[m
         await updateItem(item);[m
         return;[m
       }[m
     }[m
 [m
[31m-    // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
[32m+[m[32m    // æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ [m
     final newItem = item.copyWith([m
[31m-      id: '${DateTime.now().millisecondsSinceEpoch}_${DateTime.now().microsecond}_${_items.length}_${DateTime.now().microsecondsSinceEpoch}',[m
[32m+[m[32m      id: item.id.isEmpty[m
[32m+[m[32m          ? '${DateTime.now().millisecondsSinceEpoch}_${DateTime.now().microsecond}_${_items.length}'[m
[32m+[m[32m          : item.id,[m
       createdAt: DateTime.now(),[m
     );[m
 [m
[32m+[m[32m    debugPrint('æ–°ã—ã„ã‚¢ã‚¤ãƒ†ãƒ ID: ${newItem.id}');[m
[32m+[m
[32m+[m[32m    // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
     _items.insert(0, newItem);[m
 [m
[31m-    // ã‚·ãƒ§ãƒƒãƒ—ã«ã‚‚ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ [m
[32m+[m[32m    // å¯¾å¿œã™ã‚‹ã‚·ãƒ§ãƒƒãƒ—ã«ã‚‚è¿½åŠ [m
     final shopIndex = _shops.indexWhere((shop) => shop.id == newItem.shopId);[m
     if (shopIndex != -1) {[m
[31m-      final shop = _shops[shopIndex];[m
[31m-      final updatedItems = List<Item>.from(shop.items);[m
[31m-      updatedItems.add(newItem);[m
[31m-      _shops[shopIndex] = shop.copyWith(items: updatedItems);[m
[32m+[m[32m      _shops[shopIndex].items.add(newItem);[m
[32m+[m[32m      debugPrint('ã‚·ãƒ§ãƒƒãƒ— ${_shops[shopIndex].name} ã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ');[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ã‚·ãƒ§ãƒƒãƒ—ID ${newItem.shopId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // å…±æœ‰åˆè¨ˆã‚’æ›´æ–°ï¼ˆãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆã®ã¿ï¼‰[m
[32m+[m[32m    if (newItem.isChecked) {[m
[32m+[m[32m      debugPrint('ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ ã®ãŸã‚å…±æœ‰åˆè¨ˆã‚’æ›´æ–°');[m
[32m+[m[32m      // await _updateSharedTotalIfNeeded(); // å…±æœ‰åˆè¨ˆã¯å€‹åˆ¥ã‚¿ãƒ–ã”ã¨ã«ç®¡ç†[m
     }[m
 [m
     notifyListeners(); // å³åº§ã«UIã‚’æ›´æ–°[m
[36m@@ -120,8 +181,10 @@[m [mclass DataProvider extends ChangeNotifier {[m
           isAnonymous: _shouldUseAnonymousSession,[m
         );[m
         _isSynced = true;[m
[32m+[m[32m        debugPrint('Firebaseã«ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¿å­˜å®Œäº†');[m
       } catch (e) {[m
         _isSynced = false;[m
[32m+[m[32m        debugPrint('Firebaseä¿å­˜ã‚¨ãƒ©ãƒ¼: $e');[m
 [m
         // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯è¿½åŠ ã‚’å–ã‚Šæ¶ˆã—[m
         _items.removeAt(0);[m
[36m@@ -138,16 +201,24 @@[m [mclass DataProvider extends ChangeNotifier {[m
         notifyListeners();[m
         rethrow;[m
       }[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚Firebaseä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');[m
     }[m
   }[m
 [m
   Future<void> updateItem(Item item) async {[m
[31m-    debugPrint('DataProvider.updateItem å‘¼ã³å‡ºã—'); // ãƒ‡ãƒãƒƒã‚°ç”¨[m
[32m+[m[32m    debugPrint('=== updateItem ===');[m
[32m+[m[32m    debugPrint([m
[32m+[m[32m      'æ›´æ–°ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ : ${item.name}, ã‚·ãƒ§ãƒƒãƒ—ID: ${item.shopId}, ãƒã‚§ãƒƒã‚¯æ¸ˆã¿: ${item.isChecked}',[m
[32m+[m[32m    );[m
 [m
     // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
     final index = _items.indexWhere((i) => i.id == item.id);[m
     if (index != -1) {[m
       _items[index] = item;[m
[32m+[m[32m      debugPrint('ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã‚’æ›´æ–°');[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ã‚¢ã‚¤ãƒ†ãƒ ãƒªã‚¹ãƒˆã«ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');[m
     }[m
 [m
     // shopsãƒªã‚¹ãƒˆå†…ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚‚æ›´æ–°[m
[36m@@ -163,9 +234,14 @@[m [mclass DataProvider extends ChangeNotifier {[m
         final updatedShop = shop.copyWith(items: updatedItems);[m
         debugPrint('æ›´æ–°å¾Œã®ã‚·ãƒ§ãƒƒãƒ—äºˆç®—: ${updatedShop.budget}'); // ãƒ‡ãƒãƒƒã‚°ç”¨[m
         _shops[i] = updatedShop;[m
[32m+[m[32m        debugPrint('ã‚·ãƒ§ãƒƒãƒ— ${shop.name} ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ›´æ–°');[m
       }[m
     }[m
 [m
[32m+[m[32m    // å…±æœ‰åˆè¨ˆã‚’æ›´æ–°[m
[32m+[m[32m    debugPrint('å…±æœ‰åˆè¨ˆã‚’æ›´æ–°ä¸­...');[m
[32m+[m[32m    // await _updateSharedTotalIfNeeded(); // å…±æœ‰åˆè¨ˆã¯å€‹åˆ¥ã‚¿ãƒ–ã”ã¨ã«ç®¡ç†[m
[32m+[m
     notifyListeners(); // å³åº§ã«UIã‚’æ›´æ–°[m
 [m
     // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã®ã¿Firebaseã«ä¿å­˜[m
[36m@@ -176,8 +252,10 @@[m [mclass DataProvider extends ChangeNotifier {[m
           isAnonymous: _shouldUseAnonymousSession,[m
         );[m
         _isSynced = true;[m
[32m+[m[32m        debugPrint('Firebaseã«ã‚¢ã‚¤ãƒ†ãƒ æ›´æ–°ã‚’ä¿å­˜å®Œäº†');[m
       } catch (e) {[m
         _isSynced = false;[m
[32m+[m[32m        debugPrint('Firebaseæ›´æ–°ã‚¨ãƒ©ãƒ¼: $e');[m
 [m
         // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯å…ƒã«æˆ»ã™[m
         // æ³¨æ„: å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ã®çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚ã€[m
[36m@@ -193,16 +271,25 @@[m [mclass DataProvider extends ChangeNotifier {[m
           throw Exception('ã‚¢ã‚¤ãƒ†ãƒ ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');[m
         }[m
       }[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚Firebaseæ›´æ–°ã‚’ã‚¹ã‚­ãƒƒãƒ—');[m
     }[m
   }[m
 [m
   Future<void> deleteItem(String itemId) async {[m
[32m+[m[32m    debugPrint('=== deleteItem ===');[m
[32m+[m[32m    debugPrint('å‰Šé™¤ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ID: $itemId');[m
[32m+[m
     // å‰Šé™¤å¯¾è±¡ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’äº‹å‰ã«å–å¾—[m
     final itemToDelete = _items.firstWhere([m
       (item) => item.id == itemId,[m
       orElse: () => throw Exception('å‰Šé™¤å¯¾è±¡ã®ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'),[m
     );[m
 [m
[32m+[m[32m    debugPrint([m
[32m+[m[32m      'å‰Šé™¤ã™ã‚‹ã‚¢ã‚¤ãƒ†ãƒ : ${itemToDelete.name}, ãƒã‚§ãƒƒã‚¯æ¸ˆã¿: ${itemToDelete.isChecked}',[m
[32m+[m[32m    );[m
[32m+[m
     // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
     _items.removeWhere((item) => item.id == itemId);[m
 [m
[36m@@ -214,9 +301,16 @@[m [mclass DataProvider extends ChangeNotifier {[m
         final updatedItems = List<Item>.from(shop.items);[m
         updatedItems.removeAt(itemIndex);[m
         _shops[i] = shop.copyWith(items: updatedItems);[m
[32m+[m[32m        debugPrint('ã‚·ãƒ§ãƒƒãƒ— ${shop.name} ã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ ã‚’å‰Šé™¤');[m
       }[m
     }[m
 [m
[32m+[m[32m    // å…±æœ‰åˆè¨ˆã‚’æ›´æ–°ï¼ˆå‰Šé™¤ã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ãŒãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã®å ´åˆï¼‰[m
[32m+[m[32m    if (itemToDelete.isChecked) {[m
[32m+[m[32m      debugPrint('ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ ã®ãŸã‚å…±æœ‰åˆè¨ˆã‚’æ›´æ–°');[m
[32m+[m[32m      // await _updateSharedTotalIfNeeded(); // å…±æœ‰åˆè¨ˆã¯å€‹åˆ¥ã‚¿ãƒ–ã”ã¨ã«ç®¡ç†[m
[32m+[m[32m    }[m
[32m+[m
     notifyListeners(); // å³åº§ã«UIã‚’æ›´æ–°[m
 [m
     // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã®ã¿Firebaseã‹ã‚‰å‰Šé™¤[m
[36m@@ -227,8 +321,10 @@[m [mclass DataProvider extends ChangeNotifier {[m
           isAnonymous: _shouldUseAnonymousSession,[m
         );[m
         _isSynced = true;[m
[32m+[m[32m        debugPrint('Firebaseã‹ã‚‰ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤å®Œäº†');[m
       } catch (e) {[m
         _isSynced = false;[m
[32m+[m[32m        debugPrint('Firebaseå‰Šé™¤ã‚¨ãƒ©ãƒ¼: $e');[m
 [m
         // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯å‰Šé™¤ã‚’å–ã‚Šæ¶ˆã—[m
         _items.add(itemToDelete);[m
[36m@@ -256,17 +352,23 @@[m [mclass DataProvider extends ChangeNotifier {[m
           throw Exception('ã‚¢ã‚¤ãƒ†ãƒ ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');[m
         }[m
       }[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚Firebaseå‰Šé™¤ã‚’ã‚¹ã‚­ãƒƒãƒ—');[m
     }[m
   }[m
 [m
   // ã‚·ãƒ§ãƒƒãƒ—ã®æ“ä½œ[m
   Future<void> addShop(Shop shop) async {[m
[32m+[m[32m    debugPrint('=== addShop ===');[m
[32m+[m[32m    debugPrint('è¿½åŠ ã™ã‚‹ã‚·ãƒ§ãƒƒãƒ—: ${shop.name}, äºˆç®—: ${shop.budget}');[m
[32m+[m
     // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
     final newShop = shop.copyWith([m
       id: '${DateTime.now().millisecondsSinceEpoch}_${DateTime.now().microsecond}_${_shops.length}',[m
       createdAt: DateTime.now(),[m
     );[m
 [m
[32m+[m[32m    debugPrint('ä½œæˆã•ã‚ŒãŸã‚·ãƒ§ãƒƒãƒ—: ${newShop.name}, äºˆç®—: ${newShop.budget}');[m
     _shops.add(newShop);[m
     notifyListeners(); // å³åº§ã«UIã‚’æ›´æ–°[m
 [m
[36m@@ -278,19 +380,24 @@[m [mclass DataProvider extends ChangeNotifier {[m
           isAnonymous: _shouldUseAnonymousSession,[m
         );[m
         _isSynced = true;[m
[32m+[m[32m        debugPrint('Firebaseã«ã‚·ãƒ§ãƒƒãƒ—ã‚’ä¿å­˜å®Œäº†');[m
       } catch (e) {[m
         _isSynced = false;[m
[32m+[m[32m        debugPrint('Firebaseä¿å­˜ã‚¨ãƒ©ãƒ¼: $e');[m
 [m
         // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯è¿½åŠ ã‚’å–ã‚Šæ¶ˆã—[m
         _shops.removeLast();[m
         notifyListeners();[m
         rethrow;[m
       }[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚Firebaseä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—');[m
     }[m
   }[m
 [m
   Future<void> updateShop(Shop shop) async {[m
[31m-    debugPrint('DataProvider.updateShop å‘¼ã³å‡ºã—'); // ãƒ‡ãƒãƒƒã‚°ç”¨[m
[32m+[m[32m    debugPrint('=== updateShop ===');[m
[32m+[m[32m    debugPrint('æ›´æ–°ã™ã‚‹ã‚·ãƒ§ãƒƒãƒ—: ${shop.name} (${shop.id})');[m
     debugPrint('æ›´æ–°å‰ã®äºˆç®—: ${shop.budget}'); // ãƒ‡ãƒãƒƒã‚°ç”¨[m
 [m
     // æ¥½è¦³çš„æ›´æ–°ï¼šUIã‚’å³åº§ã«æ›´æ–°[m
[36m@@ -303,6 +410,8 @@[m [mclass DataProvider extends ChangeNotifier {[m
       _shops[index] = shop;[m
       debugPrint('æ›´æ–°å¾Œã®ã‚·ãƒ§ãƒƒãƒ—äºˆç®—: ${_shops[index].budget}'); // ãƒ‡ãƒãƒƒã‚°ç”¨[m
       notifyListeners(); // å³åº§ã«UIã‚’æ›´æ–°[m
[32m+[m[32m    } else {[m
[32m+[m[32m      debugPrint('ã‚·ãƒ§ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');[m
     }[m
 [m
     // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã®ã¿Firebaseã«ä¿å­˜[m
[36m@@ -313,8 +422,10 @@[m [mclass DataProvider extends ChangeNotifier {[m
           isAnonymous: _shouldUseAnonymousSession,[m
         );[m
         _isSynced = true;[m
[32m+[m[32m        debugPrint('Firebaseã«ã‚·ãƒ§ãƒƒãƒ—æ›´æ–°ã‚’ä¿å­˜å®Œäº†');[m
       } catch (e) {[m
         _isSynced = false;[m
[32m+[m[32m        debugPrint('Firebaseæ›´æ–°ã‚¨ãƒ©ãƒ¼: $e');[m
 [m
         // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯å…ƒã«æˆ»ã™[m
         if (index != -1 && originalShop != null) {[m
[36m@@ -331,12 +442,22 @@[m [mclass DataProvider extends ChangeNotifier {[m
           throw Exception('ã‚·ãƒ§ãƒƒãƒ—ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');[m
         }[m
       }[m
[32m+[m[32m    } else {[m
[32m+[m[32m     