# タスクリスト

## Issue情報
- **Issue番号**: #5
- **タイトル**: main_screen.dartの責務分割
- **作成日**: 2026-02-14
- **担当者**: TBD

## フェーズ1: 準備・分析（1-2日）

### タスク1-1: 既存コードの詳細分析
- [ ] main_screen.dartの全機能をリストアップ
- [ ] 各機能の依存関係マップを作成
- [ ] Provider使用箇所を特定
- [ ] 状態管理フローを図示
- [ ] 見積もり工数: 4時間

### タスク1-2: 分割設計の最終確認
- [ ] design.mdの内容をレビュー
- [ ] 分割後のファイル構成を確定
- [ ] 命名規則を確定
- [ ] チームメンバーとレビュー
- [ ] 見積もり工数: 2時間

### タスク1-3: テスト環境の準備
- [ ] 既存の動作を記録（スクリーンショット/動画）
- [ ] テストケースのチェックリスト作成
- [ ] デバイス/プラットフォーム別テスト環境準備
- [ ] 見積もり工数: 2時間

## フェーズ2: UIウィジェット分割（2-3日）

### タスク2-1: AppBarウィジェットの分割
- [ ] `main_app_bar.dart`を作成
- [ ] タブ表示ロジックを移行
- [ ] タブ追加ボタンを移行
- [ ] タブ高さ計算を移行
- [ ] タブパディング計算を移行
- [ ] タブ最大行数計算を移行
- [ ] main_screen.dartとの統合
- [ ] 動作確認（全プラットフォーム）
- [ ] 見積もり工数: 6時間

### タスク2-2: Drawerウィジェットの分割
- [ ] `main_drawer.dart`を作成
- [ ] ドロワーヘッダーを移行
- [ ] メニューアイテム一覧を移行
- [ ] ナビゲーションロジックを移行
- [ ] トライアル表示を移行
- [ ] main_screen.dartとの統合
- [ ] 動作確認（全プラットフォーム）
- [ ] 見積もり工数: 4時間

### タスク2-3: アイテムリストウィジェットの分割
- [ ] `item_list_section.dart`を作成
- [ ] 未購入リストセクションを抽出
- [ ] 購入済みリストセクションを抽出
- [ ] ReorderableListViewロジックを移行
- [ ] チェックトグル処理を移行
- [ ] 編集/削除/名前変更処理を移行
- [ ] main_screen.dartとの統合
- [ ] 動作確認（全プラットフォーム）
- [ ] 見積もり工数: 8時間

## フェーズ3: ダイアログ整理（1日）

### タスク3-1: 既存ダイアログの確認と整合性チェック
- [ ] budget_dialog.dartの統合確認
- [ ] item_edit_dialog.dartの統合確認
- [ ] sort_dialog.dartの統合確認
- [ ] tab_edit_dialog.dartの統合確認
- [ ] 見積もり工数: 2時間

### タスク3-2: 残りのダイアログ分割
- [ ] タブ追加ダイアログを`tab_add_dialog.dart`として分離
- [ ] 名前変更ダイアログを`item_rename_dialog.dart`として分離
- [ ] 一括削除ダイアログを`bulk_delete_dialog.dart`として分離
- [ ] バージョン更新ダイアログ（既存のversion_update_dialog.dartを使用）
- [ ] main_screen.dartとの統合
- [ ] 動作確認
- [ ] 見積もり工数: 4時間

## フェーズ4: ビジネスロジック分割（2-3日）

### タスク4-1: 状態管理の整理
- [ ] `main_screen_state.dart`を作成
- [ ] タブ選択状態を移行
- [ ] テーマ/フォント状態を移行
- [ ] カスタムカラー状態を移行
- [ ] 各種ID管理を移行
- [ ] 見積もり工数: 4時間

### タスク4-2: アイテム操作ロジックの分離
- [ ] `item_operations_mixin.dart`を作成
- [ ] アイテム並べ替えロジックを移行
- [ ] チェック処理ロジックを移行
- [ ] 削除処理ロジックを移行
- [ ] 更新処理ロジックを移行
- [ ] 見積もり工数: 6時間

### タスク4-3: UI計算ロジックの分離
- [ ] `ui_calculations.dart`を作成
- [ ] タブ高さ計算を移行
- [ ] タブパディング計算を移行
- [ ] タブ最大行数計算を移行
- [ ] その他のUI計算を移行
- [ ] 見積もり工数: 3時間

### タスク4-4: 初期化・ライフサイクル管理の整理
- [ ] `initialization_mixin.dart`を作成
- [ ] ハイブリッドOCR初期化を移行
- [ ] バージョンチェックを移行
- [ ] テーマ/フォント初期化を移行
- [ ] TabController初期化を移行
- [ ] 見積もり工数: 4時間

## フェーズ5: main_screen.dartの再構成（1-2日）

### タスク5-1: main_screen.dartのスリム化
- [ ] 分割したウィジェットをimport
- [ ] buildメソッドを簡素化
- [ ] 不要なコードを削除
- [ ] コメントを追加
- [ ] 行数確認（目標500行以下）
- [ ] 見積もり工数: 4時間

### タスク5-2: ファイル構造の最終調整
- [ ] import文の整理
- [ ] ディレクトリ構造の確認
- [ ] ファイル命名の一貫性確認
- [ ] 見積もり工数: 2時間

## フェーズ6: テスト・品質保証（2-3日）

### タスク6-1: 単体テスト作成
- [ ] 各ウィジェットの単体テスト作成
- [ ] Mixinの単体テスト作成
- [ ] ユーティリティ関数のテスト作成
- [ ] テストカバレッジ80%以上を目標
- [ ] 見積もり工数: 8時間

### タスク6-2: 統合テスト実施
- [ ] タブ切り替えフローのテスト
- [ ] アイテム追加/編集/削除フローのテスト
- [ ] 並べ替えフローのテスト
- [ ] 予算管理フローのテスト
- [ ] テーマ変更フローのテスト
- [ ] 見積もり工数: 6時間

### タスク6-3: プラットフォーム別動作確認
- [ ] iOS実機テスト
- [ ] Androidエミュレーターテスト
- [ ] Android実機テスト
- [ ] Webブラウザテスト（Chrome, Safari, Firefox）
- [ ] Windowsデスクトップテスト
- [ ] 見積もり工数: 6時間

### タスク6-4: パフォーマンステスト
- [ ] 起動時間計測
- [ ] タブ切り替え速度計測
- [ ] アイテムリストスクロール性能確認
- [ ] メモリ使用量確認
- [ ] 分割前とのベンチマーク比較
- [ ] 見積もり工数: 4時間

### タスク6-5: 静的分析・コード品質チェック
- [ ] `flutter analyze`実行（エラーゼロ）
- [ ] コードフォーマット確認（`flutter format`）
- [ ] 未使用import削除
- [ ] TODOコメントの確認と対応
- [ ] 見積もり工数: 2時間

## フェーズ7: ドキュメント整備・レビュー（1日）

### タスク7-1: コードドキュメント更新
- [ ] 各ファイルにヘッダーコメント追加
- [ ] 複雑なロジックにコメント追加
- [ ] README更新（必要に応じて）
- [ ] 見積もり工数: 2時間

### タスク7-2: アーキテクチャドキュメント更新
- [ ] CLAUDE.mdの更新
- [ ] ディレクトリ構造図の作成
- [ ] 依存関係図の作成
- [ ] 見積もり工数: 3時間

### タスク7-3: コードレビュー
- [ ] チームメンバーによるレビュー
- [ ] フィードバック対応
- [ ] レビュー指摘事項の修正
- [ ] 見積もり工数: 4時間

## フェーズ8: デプロイ・クロージング（0.5日）

### タスク8-1: ブランチマージ準備
- [ ] 最終動作確認
- [ ] コミットメッセージの整理
- [ ] CHANGELOG更新
- [ ] 見積もり工数: 1時間

### タスク8-2: プルリクエスト作成
- [ ] PRタイトル/説明文作成
- [ ] スクリーンショット/動画添付
- [ ] レビュアー指定
- [ ] 見積もり工数: 1時間

### タスク8-3: マージ後の確認
- [ ] CI/CDパイプライン確認
- [ ] mainブランチでの動作確認
- [ ] Issue #5のクローズ
- [ ] 見積もり工数: 1時間

## 工数見積もりサマリー

| フェーズ | タスク数 | 見積もり工数 | 想定日数 |
|---------|---------|------------|---------|
| フェーズ1: 準備・分析 | 3 | 8時間 | 1-2日 |
| フェーズ2: UIウィジェット分割 | 3 | 18時間 | 2-3日 |
| フェーズ3: ダイアログ整理 | 2 | 6時間 | 1日 |
| フェーズ4: ビジネスロジック分割 | 4 | 17時間 | 2-3日 |
| フェーズ5: main_screen再構成 | 2 | 6時間 | 1-2日 |
| フェーズ6: テスト・品質保証 | 5 | 26時間 | 2-3日 |
| フェーズ7: ドキュメント整備・レビュー | 3 | 9時間 | 1日 |
| フェーズ8: デプロイ・クロージング | 3 | 3時間 | 0.5日 |
| **合計** | **25** | **93時間** | **11-16日** |

## マイルストーン

- **M1**: フェーズ1完了（分析完了）- Day 2
- **M2**: フェーズ2-3完了（UI分割完了）- Day 6
- **M3**: フェーズ4-5完了（ロジック分割完了）- Day 11
- **M4**: フェーズ6完了（テスト完了）- Day 14
- **M5**: フェーズ7-8完了（リリース準備完了）- Day 16

## 注意事項

1. **並行作業の禁止**: main_screen.dartへの他の変更は本リファクタリング完了まで凍結
2. **バックアップ**: 作業開始前にブランチ作成、定期的にコミット
3. **動作確認**: 各フェーズ完了時に必ず全機能の動作確認を実施
4. **コミュニケーション**: 問題発生時は速やかにチームに報告
5. **柔軟性**: 想定外の問題が発生した場合は設計を見直す

## 進捗管理

各タスクのステータスを以下で管理:
- [ ] 未着手
- [進行中] 進行中
- [完了] 完了
- [保留] 保留
- [スキップ] スキップ

## リスク対応

各フェーズで以下を確認:
- ✅ 静的分析パス
- ✅ 既存テストパス
- ✅ 手動動作確認完了
- ✅ パフォーマンス劣化なし
