# タスクリスト

## フェーズ1: 調査
- [x] `familyInvites`の招待フローを確認（クライアント側コード） → クライアントに参照なし
- [x] `anonymous`コレクションの使用箇所を確認 → レガシーコード（未使用）
- [x] 既存のトークンフィールドの有無を確認 → invitedUidベースで実装

## フェーズ2: ルール修正
- [x] `familyInvites`ルール修正
  - `|| true`を削除
  - 招待対象者UID（invitedUid）による読み取り・承認ルールを実装
- [x] `anonymous`コレクションルール修正
  - `if true` → `if request.auth != null`に変更
  - サブコレクション（items, shops）も同様に変更
- [x] ルール全体のレビュー（他に`if true`がないか確認） → なし

## フェーズ3: デプロイ・確認
- [ ] `./deploy-rules.sh`でルールデプロイ
- [ ] 招待の作成・送信・承認フローの動作確認
- [ ] 匿名ユーザーのデータ操作確認
- [ ] 既存ユーザーの通常操作確認

## 依存関係
- フェーズ1 → フェーズ2 → フェーズ3（順次実行）
