# リアルタイム共有機能

## 概要

家族共有機能にリアルタイム同期機能を追加しました。これにより、家族メンバーがタブを送信すると、他のメンバーの端末でリアルタイムに受信・表示されるようになります。

## 実装内容

### 1. RealtimeSharingService
- Cloud Firestoreのリアルタイムリスナーを使用
- ファミリー情報、受信コンテンツ、同期データ、通知のリアルタイム監視
- リアルタイム送信・受信機能

### 2. TransmissionProvider の拡張
- RealtimeSharingServiceとの統合
- リアルタイム機能とフォールバック機能の両立
- 通知管理機能の追加

### 3. RealtimeNotificationWidget
- リアルタイム通知の表示
- 接続状態の表示
- 通知の確認・削除機能

## 主な機能

### リアルタイム送信
- タブの送信時にリアルタイムでFirestoreに保存
- 受信者にリアルタイム通知を送信
- 送信状態のリアルタイム更新

### リアルタイム受信
- 受信コンテンツのリアルタイム監視
- 新しいコンテンツの自動表示
- 通知のリアルタイム更新

### リアルタイム同期
- 同期データのリアルタイム監視
- 適用状態のリアルタイム更新
- 同期状態のリアルタイム表示

## 使用方法

### 1. タブの送信
1. 家族共有画面の「共有」タブを開く
2. 送信したいタブを選択
3. 「送信」または「同期送信」をタップ
4. 受信者を選択して送信

### 2. リアルタイム受信
- 他のメンバーが送信すると、リアルタイムで通知が表示されます
- 通知をタップしてコンテンツを確認
- 「適用」ボタンで自分のリストに追加

### 3. 接続状態の確認
- 画面上部に接続状態が表示されます
- 「リアルタイム接続中」：正常に接続中
- 「接続を確認中...」：接続に問題がある場合

## 技術仕様

### データベース構造
```
transmissions/
  {contentId}/
    - 送信コンテンツの詳細情報

syncData/
  {syncId}/
    - 同期データの詳細情報

notifications/
  {userId}/
    items/
      {notificationId}/
        - 通知の詳細情報
```

### リアルタイムリスナー
- ファミリー情報：`families/{familyId}`
- 受信コンテンツ：`transmissions` (where sharedWith contains userId)
- 同期データ：`syncData` (where sharedWith contains userId)
- 通知：`notifications/{userId}/items` (where isRead = false)

## 注意事項

1. **Firebase接続**: リアルタイム機能を使用するには、Firebaseプロジェクトの設定が必要です
2. **ネットワーク**: インターネット接続が必要です
3. **権限**: ファミリープランの購入が必要です
4. **フォールバック**: リアルタイム機能が利用できない場合は、従来の送信機能にフォールバックします

## 今後の改善点

1. **プッシュ通知**: アプリがバックグラウンドの時のプッシュ通知
2. **オフライン対応**: オフライン時のデータ同期
3. **暗号化**: 共有データの暗号化
4. **履歴管理**: 送受信履歴の詳細管理
5. **バッチ処理**: 大量データの効率的な処理

## トラブルシューティング

### リアルタイム接続ができない場合
1. インターネット接続を確認
2. Firebase設定を確認
3. アプリを再起動
4. ファミリープランの購入状況を確認

### 通知が表示されない場合
1. 通知権限を確認
2. ファミリーメンバーであることを確認
3. リアルタイム接続状態を確認
4. アプリを再起動

### 送信が失敗する場合
1. ネットワーク接続を確認
2. 受信者の選択を確認
3. ファミリープランの権限を確認
4. アプリを再起動
